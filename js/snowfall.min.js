!function(a,b){"use strict";function c(){return this.initial=!1,this.starting=!1,this.items=[],this.windDirection=-1,this.snowfallLevel=1,this.frameRate=30,this.windDirectionChangedInterval=4e3,this.gravitationalAcceleration=1e-4,this.imgUrls=["http://7xqnsj.com1.z0.glb.clouddn.com/snowflake_1.png","http://7xqnsj.com1.z0.glb.clouddn.com/snowflake_2.png","http://7xqnsj.com1.z0.glb.clouddn.com/snowflake_3.png"],this.imgs=[],this.imgScale=.25,this}var d=a.document,e=0;a.Snowfall=c,c.prototype={init:function(b){var c=0,e=!1,f=this;return this.initial||this.starting?this:(this.initial=!0,this.configure(b),this.canvas=this.canvas||d.querySelector("#canvas"),this.context=this.context||this.canvas.getContext("2d"),this.canvasWidth=this.canvasWidth||a.innerWidth||d.body.clientWidth||d.documentElement.clientWidth,this.canvasHeight=this.canvasHeight||a.innerHeight||d.body.clientHeight||d.documentElement.clientHeight,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.resourcesLoaded=!1,this.millisecondsPerFrame=parseInt(1e3/this.frameRate),this.imgUrls.forEach(function(a,b){f.imgs[b]=new Image,f.imgs[b].onload=function(){++c===f.imgUrls.length&&e===!1&&(f.resourcesLoaded=!0),(0===f.imgs[b].width||0===f.imgs[b].height)&&(e=!0)},f.imgs[b].src=a}),this)},start:function(){this.initial&&(this.starting=!0,this.timer=this.timer||setTimeout(this.frame.bind(this),this.millisecondsPerFrame))},frame:function(){this.resourcesLoaded===!0&&(e+=this.millisecondsPerFrame,e%this.windDirectionChangedInterval<this.millisecondsPerFrame&&(this.windDirection*=-1),this.render.call(this),this.update.call(this)),this.timer=null,this.timer=setTimeout(this.frame.bind(this),this.millisecondsPerFrame)},update:function(){this.addItems.call(this),this.updateItems.call(this)},updateItems:function(){for(var a=this.items,b=a.length,c=0,d=0;b>c;c++)a[c].x=a[c].x0+a[c].v0x*Math.abs(Math.sin(e%this.windDirectionChangedInterval/this.windDirectionChangedInterval*Math.PI))*this.windDirection,a[c].y=a[c].y0+a[c].v0y*a[c].t+this.gravitationalAcceleration*Math.pow(a[c].t,2)/2,a[c].t+=this.millisecondsPerFrame,a[c].rotationAngle+=Math.PI/50,a[c].y<this.canvasHeight&&(a[d++]=a[c]);for(;b>d;)a.pop(),b--},addItems:function(){for(var a=null,b=0,c=this.snowfallLevel,d=0;c>b;b++)d=Math.floor(Math.random()*this.imgUrls.length),a={x:0,y:0,x0:Math.floor(Math.random()*this.canvasWidth*2-.5*this.canvasWidth),y0:Math.floor(Math.random()*this.imgs[d].height)-this.imgs[d].height,v0x:200+Math.floor(10*Math.random()),v0y:Math.floor(10*Math.random())/1e3,t:0,rotationAngle:0,img:this.imgs[d],imgWidth:this.imgs[d].width,imgHeight:this.imgs[d].height},this.items.push(a)},render:function(){var a=this.context,b=0,c=this.items.length;for(a.clearRect(0,0,this.canvasWidth,this.canvasHeight);c>b;b++)a.save(),a.beginPath(),a.transform(Math.cos(this.items[b].rotationAngle)*this.imgScale,Math.sin(this.items[b].rotationAngle)*this.imgScale,-Math.sin(this.items[b].rotationAngle)*this.imgScale,Math.cos(this.items[b].rotationAngle)*this.imgScale,this.items[b].x,this.items[b].y),a.drawImage(this.items[b].img,-this.items[b].imgWidth/2,-this.items[b].imgHeight/2),a.closePath(),a.restore()},pause:function(){clearTimeout(this.timer),this.timer=null},resume:function(){this.start.call(this)},clear:function(){clearTimeout(this.timer),this.timer=null,this.context&&this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.items=[],this.initial=!1,this.starting=!1,this.resourcesLoaded=!1},configure:function(a){if(a&&"object"==typeof a&&a instanceof Object)for(var b in a)this[b]=a[b]}}}(window);